'use strict';function t(t){const e=t.toString(16);return 1===e.length?"0"+e:e}function e(e){return"#"+e.map(t).join("")}function r(t,e,r){for(let n=0;n<r.length;n++)if(o(t,e,r[n]))return!0;return!1}function o(t,e,r){switch(r.length){case 3:if(((t,e,r)=>255!==t[e+3]||t[e]===r[0]&&t[e+1]===r[1]&&t[e+2]===r[2])(t,e,r))return!0;break;case 4:if(((t,e,r)=>t[e+3]&&r[3]?t[e]===r[0]&&t[e+1]===r[1]&&t[e+2]===r[2]&&t[e+3]===r[3]:t[e+3]===r[3])(t,e,r))return!0;break;case 5:if(((t,e,r)=>{const o=r[0],s=r[1],i=r[2],a=r[3],c=r[4],h=t[e+3],d=n(h,a,c);return a?!(h||!d)||!!(n(t[e],o,c)&&n(t[e+1],s,c)&&n(t[e+2],i,c)&&d):d})(t,e,r))return!0;break;default:return!1}}function n(t,e,r){return t>=e-r&&t<=e+r}function s(t,e,o){const n={},s=o.ignoredColor,i=o.step;let a=[0,0,0,0,0];for(let o=0;o<e;o+=i){const e=t[o],i=t[o+1],c=t[o+2],h=t[o+3];if(s&&r(t,o,s))continue;const d=Math.round(e/24)+","+Math.round(i/24)+","+Math.round(c/24);n[d]?n[d]=[n[d][0]+e*h,n[d][1]+i*h,n[d][2]+c*h,n[d][3]+h,n[d][4]+1]:n[d]=[e*h,i*h,c*h,h,1],a[4]<n[d][4]&&(a=n[d])}const c=a[0],h=a[1],d=a[2],u=a[3],l=a[4];return u?[Math.round(c/u),Math.round(h/u),Math.round(d/u),Math.round(u/l)]:o.defaultColor}function i(t,e,o){let n=0,s=0,i=0,a=0,c=0;const h=o.ignoredColor,d=o.step;for(let o=0;o<e;o+=d){const e=t[o+3],d=t[o]*e,u=t[o+1]*e,l=t[o+2]*e;h&&r(t,o,h)||(n+=d,s+=u,i+=l,a+=e,c++)}return a?[Math.round(n/a),Math.round(s/a),Math.round(i/a),Math.round(a/c)]:o.defaultColor}function a(t,e,o){let n=0,s=0,i=0,a=0,c=0;const h=o.ignoredColor,d=o.step;for(let o=0;o<e;o+=d){const e=t[o],d=t[o+1],u=t[o+2],l=t[o+3];h&&r(t,o,h)||(n+=e*e*l,s+=d*d*l,i+=u*u*l,a+=l,c++)}return a?[Math.round(Math.sqrt(n/a)),Math.round(Math.sqrt(s/a)),Math.round(Math.sqrt(i/a)),Math.round(a/c)]:o.defaultColor}function c(t){return h(t,"defaultColor",[0,0,0,0])}function h(t,e,r){return void 0===t[e]?r:t[e]}function d(t,e,r){t.silent||(console.error("FastAverageColor: "+e),r&&console.error(r))}function u(t){return Error("FastAverageColor: "+t)}export default class{getColorAsync(t,e){if(!t)return Promise.reject(u("call .getColorAsync() without resource."));if("string"==typeof t){const r=new Image;return r.crossOrigin="",r.src=t,this._bindImageEvents(r,e)}if(t instanceof Image&&!t.complete)return this._bindImageEvents(t,e);{const r=this.getColor(t,e);return r.error?Promise.reject(r.error):Promise.resolve(r)}}getColor(t,e){const r=c(e=e||{});if(!t)return d(e,"call .getColor(null) without resource."),this.prepareResult(r);const o=((t,e)=>{const r=h(e,"left",0),o=h(e,"top",0),n=h(e,"width",t.width),s=h(e,"height",t.height);let i,a=n,c=s;return"precision"===e.mode||(n>s?(i=n/s,a=100,c=Math.round(a/i)):(i=s/n,c=100,a=Math.round(c/i)),(a>n||c>s||a<10||c<10)&&(a=n,c=s)),{srcLeft:r,srcTop:o,srcWidth:n,srcHeight:s,destWidth:a,destHeight:c}})((t=>{if(t instanceof HTMLImageElement){let e=t.naturalWidth,r=t.naturalHeight;return t.naturalWidth||-1===t.src.search(/\.svg(\?|$)/i)||(e=r=100),{width:e,height:r}}return t instanceof HTMLVideoElement?{width:t.videoWidth,height:t.videoHeight}:{width:t.width,height:t.height}})(t),e);if(!(o.srcWidth&&o.srcHeight&&o.destWidth&&o.destHeight))return d(e,`incorrect sizes for resource "${t.src}".`),this.prepareResult(r);if(!this._ctx&&(this._canvas="undefined"==typeof window?new OffscreenCanvas(1,1):document.createElement("canvas"),this._ctx=this._canvas.getContext&&this._canvas.getContext("2d"),!this._ctx))return d(e,"Canvas Context 2D is not supported in this browser."),this.prepareResult(r);this._canvas.width=o.destWidth,this._canvas.height=o.destHeight;let n=r;try{this._ctx.clearRect(0,0,o.destWidth,o.destHeight),this._ctx.drawImage(t,o.srcLeft,o.srcTop,o.srcWidth,o.srcHeight,0,0,o.destWidth,o.destHeight);const r=this._ctx.getImageData(0,0,o.destWidth,o.destHeight).data;n=this.getColorFromArray4(r,e)}catch(r){d(e,`security error (CORS) for resource ${t.src}.\nDetails: https://developer.mozilla.org/en/docs/Web/HTML/CORS_enabled_image`,r)}return this.prepareResult(n)}getColorFromArray4(t,e){e=e||{};const r=t.length,o=c(e);if(r<4)return o;const n=r-r%4,h=4*(e.step||1);let d;switch(e.algorithm||"sqrt"){case"simple":d=i;break;case"sqrt":d=a;break;case"dominant":d=s;break;default:throw u(e.algorithm+" is unknown algorithm.")}return d(t,n,{defaultColor:o,ignoredColor:(l=e.ignoredColor,l?Array.isArray(l)?"number"==typeof l[0]?[l.slice()]:l:[l]:l),step:h});var l}prepareResult(t){const r=t.slice(0,3),o=[].concat(r,t[3]/255),n=(299*(s=t)[0]+587*s[1]+114*s[2])/1e3<128;var s;return{value:t,rgb:"rgb("+r.join(",")+")",rgba:"rgba("+o.join(",")+")",hex:e(r),hexa:e(t),isDark:n,isLight:!n}}destroy(){delete this._canvas,delete this._ctx}_bindImageEvents(t,e){return new Promise(((r,o)=>{const n=()=>{a();const n=this.getColor(t,e);n.error?o(n.error):r(n)},s=()=>{a(),o(u(`Error loading image "${t.src}".`))},i=()=>{a(),o(u(`Image "${t.src}" loading aborted.`))},a=()=>{t.removeEventListener("load",n),t.removeEventListener("error",s),t.removeEventListener("abort",i)};t.addEventListener("load",n),t.addEventListener("error",s),t.addEventListener("abort",i)}))}}